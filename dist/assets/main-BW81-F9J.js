import"./modulepreload-polyfill-B5Qt9EMX.js";import{m as lt}from"./mainnet-node-list-CbXJ3SIC.js";import{dryrun as Z}from"https://unpkg.com/@permaweb/aoconnect@0.0.82/dist/browser.js";import"./nav-BgMtwFJp.js";const ct={permaswap:"rgb(54, 162, 235)",botega:"rgb(255, 99, 132)",wARTransfer:"rgb(255, 159, 64)",wARVolume:"rgb(255, 159, 64)",wARweeklyTransfer:"rgb(255, 159, 64)",llamaLand:"rgb(255, 205, 86)",stargrid:"rgb(131, 86, 255)",stargridRanked:"rgb(45, 142, 142)",stargridTotal:"rgb(75, 48, 150)",AOTransfer:"rgb(47, 243, 8)",AOVolume:"rgb(47, 243, 8)",wUSDCTransfer:"rgb(19, 62, 252)",wUSDCVolume:"rgb(19, 62, 252)",USDATransfer:"rgb(51, 139, 0)",bazarAADaily:"rgb(249, 110, 70)"},N={"1D":1440*60*1e3,"1W":10080*60*1e3,"1M":720*60*60*1e3,"3M":2160*60*60*1e3,"6M":4320*60*60*1e3,"9M":270*24*60*60*1e3,"1Y":360*24*60*60*1e3},dt=["stargrid","stargridMatches","wARVolume","AOVolume","wUSDCVolume"],ut=["wARTransfer","AOTransfer","permaswap","botega","llamaLand","wARTotalSupply"],I="1W",ft="V5Pm1eScgJo1Ue6R0NL_qVUM53leE_B3zavwf1Z5zPk",M={dateOnly:{month:"short",day:"numeric"},dateYear:{year:"numeric",month:"short",weekday:"short",day:"numeric"},short:{month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0},tooltip:{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0,weekday:"short"}},w={tension:.1,pointRadius:5,responsive:!0,maintainAspectRatio:!1},B={permaswap:{description:"Permaswap Order Notice Processes",protocol:"ao",action:"Order-Notice",spawnerProcess:"5G5_ftQT6f2OsmJ8EZ4-84eRcIMNEmUyH9aQSD85f9I",displayName:"Permaswap Swaps",defaultAddresses:["xZwIYa2DapmKmOpqOn9iMN0YQnYV4hgtwKadiKBpbt8","SMKH5JnFE7c0MjsURMVRZn7kUerg1yMwcnVbWJJBEDU","tnzfEWXA9CRxr9lBGZbZfVEZux44lZj3pqMJCK5cHgc","dBbZhQoV4Lq9Bzbm0vlTrHmOZT7NchC_Dillbmqx0tM","vJY-ed1Aoa0pGgQ30BcpO9ehGBu1PfNHUlwV9W8_n5A","-9lYCEgMbASuQMr76ddhnaT3H996UFjMPc5jOs3kiAk","qhMOXu9ANdOmOE38fHC3PnJuRsAQ6JzGFNq09oBSmpM","7AOIMfTZVpX52-XYBDS7VHsXdqEYYsGdYND_MoEVEwg"]},botega:{description:"Botega Order Confirmation Processes",protocol:"ao",action:"Order-Confirmation",spawnerProcess:"3XBGLrygs11K63F_7mldWz4veNx6Llg6hI2yZs8LKHo",displayName:"Botega Swaps"},wARTransfer:{description:"wAR Token Transfer",fromProcess:["xU9zFkq3X2ZQ6olwNVvr1vUWIjc3kXTWr7xKQD6dh10"],action:"Credit-Notice",displayName:"wAR Transfers"},wARweeklyTransfer:{description:"wAR Weekly Token Transfer",fromProcess:["xU9zFkq3X2ZQ6olwNVvr1vUWIjc3kXTWr7xKQD6dh10"],action:"Credit-Notice",displayName:"wAR Weekly Transfers"},wUSDCTransfer:{description:"wUSDC Token Transfer",fromProcess:["7zH9dlMNoxprab9loshv3Y7WG45DOny_Vrq9KrXObdQ"],action:"Credit-Notice",displayName:"wUSDC Transfers"},USDATransfer:{description:"USDA Token Transfer",fromProcess:["FBt9A5GA_KXMMSxA2DJ0xZbAq8sLLU2ak-YJe9zDvg8"],action:"Credit-Notice",displayName:"USDA Transfers"},AOTransfer:{description:"AO Token Transfer",fromProcess:["0syT13r0s0tgPmIed95bJnuSqaD29HQNN8D3ElLSrsc"],action:"Credit-Notice",displayName:"AO Transfers"},wARTotalSupply:{description:"wAR Total Supply",wARProcess:"Bi6bSPz-IyOCX9ZNedmLzv7Z6yxsrj9nHE1TnZzm_ks",action:"SupplyHistory"},llamaLand:{description:"LlamaLand Login Info",fromProcess:["2dFSGGlc5xJb0sWinAnEFHM-62tQEbhDzi1v5ldWX5k"],action:"Login-Info",message:"No Reward",displayName:"LlamaLand"},bazarAADaily:{description:"Atomic Asset Creation Tracking",displayName:"Atomic Assets Creation Daily",ticker:"ATOMIC",action:"Bootloader-Ticker",displayName:"Atomic Assets"}},P=new Map;async function tt(t,e=[]){const n=`process-addresses-${t}`;if(P.has(n))return P.get(n);const s=a=>`
        query {
            transactions(
                block: {min: 0}
                tags: [
                    { name: "From-Process", values: "${t}" }
                    { name: "Action", values: "Spawned" }
                ],
                first: 100,
                after: ${a?`"${a}"`:null}
            ) {
                edges {
                    node {
                        id
                        tags {
                            name
                            value
                        }
                    }
                    cursor
                }
                pageInfo {
                    hasNextPage
                }
            }
        }
    `;try{const a=new Set;let r=!0,o=null,i=0;const d=10;for(console.log(`Fetching process addresses for spawner ${t}...`);r&&i<d;){i++;const g=await fetch("https://ao-search-gateway.goldsky.com/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:s(o)})});if(!g.ok)throw new Error(`Network error: ${g.status}`);const c=await g.json();if(c.errors){console.error("GraphQL errors:",c.errors);break}const u=c.data.transactions;u.edges.forEach(h=>{if(!h.node.tags)return;h.node.tags.filter(T=>T.name==="Process").forEach(T=>{a.add(T.value)})}),r=u.pageInfo.hasNextPage,r&&u.edges.length>0?o=u.edges[u.edges.length-1].cursor:r=!1}e.forEach(g=>a.add(g));const l=Array.from(a);return P.set(n,l),console.log(`Found ${l.length} processes for spawner ${t}`),l}catch(a){return console.error(`Error fetching process addresses for ${t}:`,a),console.log(`Using ${e.length} default addresses for ${t}`),P.set(n,e),e}}async function gt(t,e,n,s){const a=B[t];if(!a)throw new Error(`Unknown process type: ${t}`);const r=n===s?`block: { min: ${e} }`:`block: { min: ${e}, max: ${n} }`;switch(t){case"permaswap":{const o=await tt(a.spawnerProcess,a.defaultAddresses);return`query {
                transactions (
                    ${r}
                    tags: [
                        { name: "Data-Protocol", values: ["${a.protocol}"] }
                        { name: "Action", values: ["${a.action}"] }
                        { name: "From-Process", values: ${JSON.stringify(o)} }
                    ]
                ) {
                    count
                }
            }`}case"botega":{const o=await tt(a.spawnerProcess,a.defaultAddresses);return`query {
                transactions (
                    ${r}
                    tags: [
                        { name: "Data-Protocol", values: ["${a.protocol}"] }
                        { name: "Action", values: ["${a.action}"] }
                        { name: "From-Process", values: ${JSON.stringify(o)} }
                    ]
                ) {
                    count
                }
            }`}case"wARTransfer":case"wARweeklyTransfer":case"wUSDCTransfer":case"USDATransfer":case"AOTransfer":return`query {
                transactions (
                    ${r}
                    tags:[
                        { name:"Action", values: ["${a.action}"]},
                        { name: "From-Process", values: ${JSON.stringify(a.fromProcess)}},
                    ]
                ) {
                    count
                }
            }`;case"llamaLand":return`query {
                transactions(
                    ${r}
                    tags: [
                        { name: "From-Process", values: ${JSON.stringify(a.fromProcess)}}
                        { name: "Action", values: "${a.action}" },
                        { name: "Message", values: "${a.message}" },
                    ],
                    sort: HEIGHT_DESC
                ) {
                    count
                }
            }`;case"bazarAADaily":return`query {
                transactions(
                    ${r}
                    tags: [
                        { name: "${a.action}", values: ["${a.ticker}"] }
                    ]
                ) {
                    count
                }
            }`;default:throw new Error(`Query template not found for process type: ${t}`)}}function R(t){return B[t]?.displayName||t}const p=new Map;async function j(){try{const t="network-info";if(p.has(t)){const{data:s,timestamp:a}=p.get(t);if(Date.now()-a<300*1e3)return s}const e=await fetch("https://arweave.net/info");if(!e.ok)throw new Error(`Network error: ${e.status} ${e.statusText}`);const n=await e.json();return p.set(t,{data:n,timestamp:Date.now()}),n}catch(t){throw console.error("Error fetching network info:",t),t}}async function G(){try{const t="block-history";if(p.has(t)){const{data:r,timestamp:o}=p.get(t);if(Date.now()-o<900*1e3)return r}const e=await Z({process:ft,data:"",tags:[{name:"Action",value:"BlocksHistory"},{name:"Data-Protocol",value:"ao"},{name:"Type",value:"Message"},{name:"Variant",value:"ao.TN.1"}]});if(!e||!e.Messages||!e.Messages[0]||!e.Messages[0].Tags)throw new Error("Invalid block history response");const n=e.Messages[0].Tags.find(r=>r.name==="DailyBlocks");if(!n)throw new Error("No DailyBlocks tag found in the response");const a=JSON.parse(n.value).sort((r,o)=>new Date(o.date)-new Date(r.date));return p.set(t,{data:a,timestamp:Date.now()}),a}catch(t){throw console.error("Error fetching block history:",t),t}}async function ht(){try{const t="supply-history";if(p.has(t)){const{data:r,timestamp:o}=p.get(t);if(Date.now()-o<1800*1e3)return r}const[e]=await Promise.all([Z({process:"Bi6bSPz-IyOCX9ZNedmLzv7Z6yxsrj9nHE1TnZzm_ks",data:"",tags:[{name:"Action",value:"SupplyHistory"},{name:"Data-Protocol",value:"ao"},{name:"Type",value:"Message"},{name:"Variant",value:"ao.TN.1"}]})]),n=e.Messages[0].Tags.find(r=>r.name==="DailySupply"),a={wAR:JSON.parse(n.value)};return p.set(t,{data:a,timestamp:Date.now()}),a}catch(t){throw console.error("Error fetching supply history:",t),t}}async function V(t,e,n){try{const s=`${t}-${JSON.stringify(e.map(o=>o.startHeight+"-"+o.endHeight))}`;if(p.has(s)){const{data:o,timestamp:i}=p.get(s);if(Date.now()-i<600*1e3)return o}const a=10,r=[];for(let o=0;o<e.length;o+=a){const i=e.slice(o,o+a),d=await Promise.all(i.map(async(l,g)=>{try{const c=await gt(t,l.startHeight,l.endHeight,n),u=await fetch("https://ao-search-gateway.goldsky.com/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:c})});if(!u.ok)throw new Error(`Network error: ${u.status}`);const h=await u.json();return h.errors?(console.error(`GraphQL errors for ${t}:`,h.errors),{timestamp:l.endTime,count:0}):{timestamp:l.endTime,count:h.data.transactions.count}}catch(c){return console.error(`Error fetching data for ${t} (period ${o+g}):`,c),{timestamp:l.endTime,count:0}}}));r.push(...d),o+a<e.length&&await new Promise(l=>setTimeout(l,100))}return p.set(s,{data:r,timestamp:Date.now()}),r}catch(s){throw console.error(`Error fetching process data for ${t}:`,s),s}}async function at(){try{const t="volume-stats";if(p.has(t)){const{data:r,timestamp:o}=p.get(t);if(Date.now()-o<1800*1e3)return r}const e=await fetch("https://raw.githubusercontent.com/Jonny-Ringo/the_eye_of_AO/main/data/volume-stats.json");if(!e.ok)throw new Error(`Network error: ${e.status} ${e.statusText}`);const s=(await e.json()).volumeData,a={AO:s.AO.map(r=>({timestamp:new Date(r.date).getTime(),value:r.volume})),wAR:s.wAR.map(r=>({timestamp:new Date(r.date).getTime(),value:r.volume})),wUSDC:s.wUSDC.map(r=>({timestamp:new Date(r.date).getTime(),value:r.volume}))};return p.set(t,{data:a,timestamp:Date.now()}),console.log("Processed volume data:",a),a}catch(t){throw console.error("Error fetching volume data:",t),t}}async function H(){try{const t="stargrid-history";if(p.has(t)){const{data:o,timestamp:i}=p.get(t);if(Date.now()-i<900*1e3)return o}const e=await Z({process:"wTTkZPnORwkt8PMV7CpJ4KVHUV3cY8pWKJgHkUEGM4g",data:"",tags:[{name:"Action",value:"GetDailyStats"},{name:"Data-Protocol",value:"ao"},{name:"Type",value:"Message"},{name:"Variant",value:"ao.TN.1"}]}),n=e.Messages[0]?.Tags.find(o=>o.name==="DailyStats");if(!n)throw new Error("No DailyStats tag found");const s=JSON.parse(n.value);let a=Object.entries(s).map(([o,i])=>({timestamp:new Date(Number(o)).toISOString(),casual:i.MatchesPlayedPerType?.Casual,ranked:i.MatchesPlayedPerType?.Ranked,count:i.ActiveUsersCount}));const r=e.Messages[0]?.Tags.find(o=>o.name==="TodayStats");if(r){const o=JSON.parse(r.value);a.push({timestamp:new Date(o.Date).toISOString(),casual:o.MatchesPlayedPerType?.Casual||0,ranked:o.MatchesPlayedPerType?.Ranked||0,count:o.ActiveUsersCount})}return a.sort((o,i)=>new Date(o.timestamp)-new Date(i.timestamp)),p.set(t,{data:a,timestamp:Date.now()}),a}catch(t){throw console.error("Error fetching stargrid history:",t),t}}function y(t,e=M.short){return t.toLocaleString("en-US",e)}function x(t){const e=t.toLocaleDateString("en-US",{timeZone:"UTC",weekday:"short",year:"numeric",month:"short",day:"numeric"});return t.toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),`${e}`}function E(t,e){return t.reduce((n,s)=>{const a=new Date(s.date),r=n?new Date(n.date):null,o=Math.abs(a-e),i=r?Math.abs(r-e):1/0;return o<i?s:n},null)}function nt(t){const e=new Date(t);return e.setUTCHours(0,0,0,0),e}function mt(t){const e=new Date(t);e.setUTCHours(0,0,0,0);const n=e.getUTCDay();return e.setUTCDate(e.getUTCDate()-n),t<e&&e.setUTCDate(e.getUTCDate()-7),e}function wt(t,e){const n=nt(new Date),s=[{endTime:new Date,startTime:n,endHeight:t,startHeight:e[0].blockHeight}];for(let a=1;a<14;a++){const r=new Date(n);r.setUTCDate(r.getUTCDate()-(a-1));const o=new Date(r);o.setUTCDate(o.getUTCDate()-1);const i=E(e,r),d=E(e,o);i&&d&&s.push({endTime:r,startTime:o,endHeight:i.blockHeight,startHeight:d.blockHeight})}return s.reverse()}function U(t,e){if(!t||t.length===0)return[];const n=new Date,s=N[e]||N["1M"];return t.filter(a=>{const r=new Date(a.timestamp);return n-r<=s})}function pt(t,e){let n;return function(...a){const r=()=>{clearTimeout(n),t(...a)};clearTimeout(n),n=setTimeout(r,e)}}const b={};function yt(t,e){const n=document.getElementById("blockInfo");if(!n)return;const s=new Date(e.endTime),a=y(s);n.textContent=`Current Block: ${t} | Latest Period (${a}): ${e.startHeight} - ${e.endHeight}`}function m(t,e=!0){let n;if(t==="USDATransfer"?n="wUSDCTransferLoader":n=`${t}Loader`,document.getElementById("chartModal").classList.contains("active"))z(e);else{const a=document.getElementById(n);a?a.style.display=e?"flex":"none":console.warn(`Loader element not found: ${n} for process ${t}`)}}function z(t=!0){let e=document.getElementById("modalLoader");t&&!e&&(e=document.createElement("div"),e.id="modalLoader",e.className="loader-container",e.style.zIndex="10001",e.innerHTML=`
            <div class="loader"></div>
            <div class="loader-text">Loading chart data...</div>
        `,document.body.appendChild(e)),e&&(e.style.display=t?"flex":"none",t||setTimeout(()=>{e&&e.style.display==="none"&&e.remove()},100))}function K(t=!0){const e=document.getElementById("mainLoader");e&&(e.style.display=t?"flex":"none")}function Dt(){document.querySelectorAll(".chart-loader").forEach(e=>{e.style.display="flex"})}function ot(t,e){const n=document.querySelectorAll(".chart-card");["wARTransfer","wUSDCTransfer","USDATransfer","AOTransfer","permaswap","botega","llamaLand","wARweeklyTransfer","wARTotalSupply","stargrid","AOVolume","wARVolume","wUSDCVolume","bazarAADaily","stargridMatches"].forEach(a=>{b[a]=I}),n.forEach(a=>{const r=a.querySelector("canvas");if(!r){console.warn("No canvas found in chart card",a);return}let o;r.id==="wARTotalSupplyChart"?o="wARTotalSupply":o=r.id.replace("Chart",""),b[o]=I;const i=a.querySelectorAll(".chart-action-btn");i.forEach(l=>{const g=l.cloneNode(!0);l.parentNode.replaceChild(g,l),g.addEventListener("click",async()=>{const c=g.textContent.trim();if(c===b[o]){console.log(`${o}: Already showing ${c} time range`);return}a.querySelectorAll(".chart-action-btn").forEach(u=>{u.classList.remove("active")}),g.classList.add("active"),m(o,!0),b[o]=c;try{o==="wARTransfer"?c==="1M"||c==="3M"?await t(o,c):D(o,c):o==="wUSDCTransfer"?c==="1M"||c==="3M"?await t(o,c):D(o,c):["AOVolume","wARVolume","wUSDCVolume","AOTransfer","permaswap","botega","llamaLand","stargrid","bazarAADaily"].includes(o)&&(c==="1M"||c==="3M")?await t(o,c):o==="wARweeklyTransfer"&&(c==="1M"||c==="3M"||c==="6M"||c==="9M"||c==="1Y")?await e(o,c):D(o,c)}catch(u){console.error(`Error updating chart for ${o}:`,u)}finally{m(o,!1)}})});const d=Array.from(i).find(l=>l.textContent.trim()===I);d?d.classList.add("active"):i.length>0&&i[0].classList.add("active")})}function Tt(){const t=pt(()=>{const e=window.innerWidth<768,n=document.querySelector(".dashboard-grid");n&&(e?n.style.gridTemplateColumns="1fr":n.style.gridTemplateColumns="repeat(auto-fit, minmax(min(100%, 500px), 1fr))")},200);window.addEventListener("resize",t),t()}function St(){const t=window.location.pathname;document.querySelectorAll(".nav-item").forEach(n=>{const s=n.getAttribute("href");(t.includes(s)&&s!=="/"&&s!=="/index.html"||s==="/index.html"&&(t==="/"||t==="/index.html"))&&n.classList.add("active")})}function k(t){return b[t]||I}function Ct(){K(!0),Dt(),St(),Tt(),Object.keys(b).forEach(t=>{b[t]=I})}const S={},f={};function $(t){return ct[t]||"rgb(0, 0, 0)"}function At(t){return{label:function(e){const n=e.dataIndex;if(!f[t]||!f[t][n])return`Value: ${e.raw}`;const s=f[t][n];if(["AOVolume","wARVolume","wUSDCVolume"].includes(t)){const o=Number(s.value||s.count||e.raw||0);if(isNaN(o))return console.warn(`Invalid value for ${t}:`,s),"Invalid value";let i;if(["AOVolume","wARVolume"].includes(t)){const d=Math.floor(o/Math.pow(10,12)),l=t.replace("Volume","");i=`Volume: ${d.toLocaleString()} ${l}`}else i=`Volume: ${Math.floor(o/Math.pow(10,6)).toLocaleString()} wUSDC`;if(n===f[t].length-1){const d=y(new Date);return`${i} (Current data as of ${d})`}return i}const r=`Count: ${(s.count||0).toLocaleString()}`;if(n===f[t].length-1){const o=y(new Date);return`${r} (Current data as of ${o})`}return r},title:function(e){const n=e[0].dataIndex;if(!f[t]||!f[t][n])return e[0].label;const s=f[t][n];if(!s)return e[0].label;const a=new Date(s.timestamp);if(ut.includes(t)){const r=new Date(a.getTime());return y(r,M.dateYear)}else return dt.includes(t)?x(a):y(a,M.dateYear)}}}function bt(){return{label:function(t){const e=t.raw;return`Supply: ${Math.round(e).toLocaleString()}`}}}function q(){return{display:!0,labels:{usePointStyle:!0,pointStyle:"line",pointRadius:5,generateLabels:function(t){return Chart.defaults.plugins.legend.labels.generateLabels(t).map((n,s)=>{const a=t.data.datasets[s].borderColor;return{...n,fillStyle:a,strokeStyle:a,lineWidth:2}})}}}}function Y(){return{y:{beginAtZero:!0,ticks:{callback:function(t){return Number(t).toLocaleString()}}},x:{ticks:{sampleSize:30,maxRotation:45,minRotation:45,callback:function(t,e,n){const s=new Date(this.getLabelForValue(t));return y(s,M.dateOnly)}}}}}function kt(t){const e=t+"Chart",n=document.getElementById(e)?.getContext("2d");return n?new Chart(n,{type:"line",data:{labels:[],datasets:[{label:R(t),data:[],borderColor:$(t),tension:w.tension,pointRadius:w.pointRadius}]},options:{responsive:w.responsive,maintainAspectRatio:w.maintainAspectRatio,scales:Y(),plugins:{legend:q(),tooltip:{callbacks:At(t)}}}}):(console.error(`Cannot create chart: Canvas element ${e} not found`),null)}function vt(t,e){const n=t+"Chart",s=document.getElementById(n)?.getContext("2d");if(!s)return console.error(`Cannot create chart: Canvas element ${n} not found`),null;f[t]||(f[t]=[]),f[e]||(f[e]=[]);let a,r,o,i;return a=R(t),r=R(e),o=$(t),i=$(e),new Chart(s,{type:"line",data:{labels:[],datasets:[{label:a,data:[],borderColor:o,tension:w.tension,pointRadius:w.pointRadius},{label:r,data:[],borderColor:i,tension:w.tension,pointRadius:w.pointRadius}]},options:{responsive:w.responsive,maintainAspectRatio:w.maintainAspectRatio,scales:Y(),plugins:{legend:q(),tooltip:{callbacks:Ot(t,e)}}}})}function Et(){const t="stargridMatchesChart",e=document.getElementById(t)?.getContext("2d");return e?new Chart(e,{type:"line",data:{labels:[],datasets:[{label:"Casual Matches",data:[],borderColor:$("stargrid"),tension:w.tension,pointRadius:w.pointRadius},{label:"Ranked Matches",data:[],borderColor:$("stargridRanked"),tension:w.tension,pointRadius:w.pointRadius},{label:"Total Matches",data:[],borderColor:$("stargridTotal"),tension:w.tension,pointRadius:w.pointRadius}]},options:{responsive:w.responsive,maintainAspectRatio:w.maintainAspectRatio,scales:Y(),plugins:{legend:q(),tooltip:{callbacks:It()}}}}):(console.error(`Cannot create chart: Canvas element ${t} not found`),null)}function $t(){const t="wARTotalSupplyChart",e=document.getElementById(t)?.getContext("2d");return e?new Chart(e,{type:"line",data:{labels:[],datasets:[{label:"wAR Total Supply",data:[],borderColor:$("wARTransfer"),tension:w.tension,pointRadius:w.pointRadius}]},options:{responsive:w.responsive,maintainAspectRatio:w.maintainAspectRatio,plugins:{legend:q(),tooltip:{callbacks:bt()}},scales:{y:{beginAtZero:!0,ticks:{callback:function(n){return Number(n).toLocaleString()}}},x:{ticks:{sampleSize:30,maxRotation:45,minRotation:45,callback:function(n,s,a){const r=new Date(this.getLabelForValue(n));return y(r,M.dateOnly)}}}}}}):(console.error(`Cannot create chart: Canvas element ${t} not found`),null)}async function Q(t,e){["stargrid","AOVolume","wARVolume","wUSDCVolume"].includes(t)?await Mt(t):["stargridMatches"].includes(t)?await rt(t):(console.log(`Using fetchAdditionalData for ${t}`),await Bt(t,e))}async function Mt(t){try{m(t,!0);let e;if(t==="stargrid")e=await H();else if(["AOVolume","wARVolume","wUSDCVolume"].includes(t)){const s=await qt(t),a=t.replace("Volume","");e=s[a].map(r=>({timestamp:r.timestamp,count:r.value})),console.log(`Processing ${e.length} entries for ${t}`)}if(!e)throw new Error(`Failed to fetch ${t} data`);f[t]=e;const n=k(t);console.log(`Updating ${t} with time range: ${n}`),D(t,n||"1M"),m(t,!1)}catch(e){console.error(`Error updating ${t} chart:`,e),m(t,!1)}}async function rt(t,e=null){try{m(t,!0);let n;if(e)n=e,console.log(`Using pre-filtered data for ${t}:`,e.length,"entries");else{const r=await H();if(!r)throw new Error("Failed to fetch Stargrid stats");const o=r.map(d=>({timestamp:d.timestamp,casual:d.casual||0,ranked:d.ranked||0}));f[t]=o;const i=k(t);console.log(`Updating ${t} with time range: ${i}`),n=U(o,i||"1M")}const s=S[t];if(!s)throw new Error(`No chart found for process: ${t}`);const a=[...n].sort((r,o)=>new Date(r.timestamp)-new Date(o.timestamp));f[`${t}_displayed`]=a,console.log("Final data for chart update:",{processName:t,totalEntries:a.length,firstEntry:a[0]?.timestamp,lastEntry:a[a.length-1]?.timestamp}),s.data.labels=a.map(r=>x(new Date(r.timestamp))),s.data.datasets[0].data=a.map(r=>r.casual||0),s.data.datasets[1].data=a.map(r=>r.ranked||0),s.data.datasets[2].data=a.map(r=>(r.casual||0)+(r.ranked||0)),s.update("none"),m(t,!1)}catch(n){console.error(`Error updating ${t} chart:`,n),m(t,!1)}}function Rt(){return Object.keys(S).forEach(t=>{S[t]&&S[t].destroy()}),S.wUSDCTransfer=vt("wUSDCTransfer","USDATransfer"),S.wARTotalSupply=$t(),S.stargridMatches=Et(),["wUSDCVolume","wARweeklyTransfer","wARTransfer","wARVolume","AOTransfer","AOVolume","permaswap","botega","llamaLand","stargrid","bazarAADaily"].forEach(t=>{S[t]=kt(t)}),ot(Q),S}function Ut(t,e){console.log(`Updating chart for ${t} with`,e);const n=S[t];if(!n){console.error(`No chart found for process: ${t}`);return}const s=[...e].sort((o,i)=>new Date(o.timestamp)-new Date(i.timestamp));f[t]=s;const a=s.map(o=>{const i=new Date(o.timestamp);return["stargrid","wARVolume","AOVolume","wUSDCVolume"].includes(t)?x(i):y(i)}),r=s.map(o=>{const i=o.count||o.value||0;return["AOVolume","wARVolume"].includes(t)?i/1e12:t==="wUSDCVolume"?i/1e6:i});n.data.labels=a,n.data.datasets[0].data=r,n.data.datasets[0].label=R(t),n.update("none")}function st(t,e,n){const s=S[t];if(!s){console.error(`No chart found for process: ${t}`);return}const a=f[t]||[],r=f[e]||[];if(a.length===0&&r.length===0){console.warn(`No data available for ${t} or ${e}`);return}const o=U(a,n),i=U(r,n);Lt(s,t,e,o,i)}function Lt(t,e,n,s,a){const r=[...s.map(u=>u.timestamp),...a.map(u=>u.timestamp)],o=[...new Set(r)].sort((u,h)=>new Date(u)-new Date(h)),i=[],d=[],l=[],g=[],c=[];o.forEach(u=>{const h=s.find(A=>A.timestamp===u),C=a.find(A=>A.timestamp===u);i.push(h?h.count:null),d.push(C?C.count:null),g.push(h||{timestamp:u,count:null}),c.push(C||{timestamp:u,count:null});const T=new Date(u);l.push(y(T))}),f[e]=g,f[n]=c,t.data.labels=l,t.data.datasets[0].data=i,t.data.datasets[1].data=d,t.data.datasets[0].label=R(e),t.data.datasets[1].label=R(n),t.update("none")}function Ot(t,e){return{label:function(n){const s=n.datasetIndex,a=n.dataIndex,o=f[s===0?t:e];if(!o||!o[a])return`${n.dataset.label}: ${n.raw}`;const i=o[a].count;if(a===o.length-1){const d=y(new Date);return`${n.dataset.label}: ${i} (Current data as of ${d})`}return`${n.dataset.label}: ${i}`},title:function(n){const s=n[0].dataIndex,a=f[t];if(a&&a[s]){const o=new Date(a[s].timestamp);return y(o,M.tooltip)}const r=f[e];if(r&&r[s]){const o=new Date(r[s].timestamp);return y(o,M.tooltip)}return n[0].label}}}function It(){return{label:function(t){const e=t.dataset.label||"",n=t.parsed.y,s=t.dataIndex,a=t.chart.data.labels.length;if(s===a-1){const r=y(new Date);return`${e}: ${n.toLocaleString()} (Current data as of ${r})`}return`${e}: ${n.toLocaleString()}`},title:function(t){const e=t[0].dataIndex,n=f.stargridMatches_displayed||f.stargridMatches,s=n[e];if(!s)return"";const a=new Date(s.timestamp);return e===n.length-1?(y(new Date),`${x(a)}`):x(a)}}}function D(t,e){let n=f[t]||[];n=[...n].sort((a,r)=>new Date(a.timestamp)-new Date(r.timestamp));const s=Vt(n,t.includes("weekly"));if(f[t]=s,t==="wUSDCTransfer")st("wUSDCTransfer","USDATransfer",e);else if(t==="wARTotalSupply")Ht(f[t],e);else if(t==="stargridMatches"){const a=U(s,e);rt(t,a)}else{const a=U(s,e);Ut(t,a)}}function Vt(t,e=!1){if(!t||t.length===0)return[];const n=new Date,s=`${n.getUTCFullYear()}-${String(n.getUTCMonth()+1).padStart(2,"0")}-${String(n.getUTCDate()).padStart(2,"0")}`;console.log("Today's UTC date:",s);const a=[],r=[];t.forEach(c=>{if(!c||!c.timestamp)return;const u=new Date(c.timestamp);`${u.getUTCFullYear()}-${String(u.getUTCMonth()+1).padStart(2,"0")}-${String(u.getUTCDate()).padStart(2,"0")}`===s?a.push(c):r.push(c)});let o=null,i=null;a.forEach(c=>{const u=new Date(c.timestamp);u.getUTCHours()===0&&u.getUTCMinutes()===0&&u.getUTCSeconds()===0?o=c:(!i||new Date(c.timestamp)>new Date(i.timestamp))&&(i=c)});const d=new Map;r.forEach(c=>{let u;if(e){const h=new Date(c.timestamp),C=h.getUTCDay(),T=new Date(h);T.setUTCDate(h.getUTCDate()-C),T.setUTCHours(0,0,0,0),u=T.toISOString().split("T")[0]}else{const h=new Date(c.timestamp);u=`${h.getUTCFullYear()}-${String(h.getUTCMonth()+1).padStart(2,"0")}-${String(h.getUTCDate()).padStart(2,"0")}`}(!d.has(u)||new Date(c.timestamp)>new Date(d.get(u).timestamp))&&d.set(u,c)});const l=Array.from(d.values());return o&&l.push(o),i&&l.push(i),l.sort((c,u)=>new Date(c.timestamp)-new Date(u.timestamp))}let v=null;function xt(t){const e=document.getElementById(`${t}Chart`),n=S[t];if(!n||!e){console.error(`Chart not found: ${t}`);return}const s=document.getElementById("chartModal"),a=document.getElementById("chartModalTitle"),r=document.getElementById("chartModalCanvas"),o=document.getElementById("chartModalActions");a.textContent=n.data.datasets[0]?.label||t;const d=e.closest(".chart-card")?.querySelector(".chart-actions");if(d){o.innerHTML="";const c=d.querySelectorAll(".chart-action-btn");c.forEach((h,C)=>{const T=h.cloneNode(!0);T.addEventListener("click",async()=>{z(!0),o.querySelectorAll(".chart-action-btn").forEach(L=>L.classList.remove("active")),T.classList.add("active");const A=T.textContent.trim();b[t]=A;try{["1M","3M"].includes(A)?await Q(t,A):await D(t,A),v&&v.destroy();const L=r.getContext("2d"),it={type:n.config.type,data:JSON.parse(JSON.stringify(n.data)),options:JSON.parse(JSON.stringify(n.options))};v=new Chart(L,it)}catch(L){console.error(`Error updating modal chart for ${t}:`,L)}finally{z(!1)}}),o.appendChild(T)});const u=d.querySelector(".chart-action-btn.active");if(u){const h=Array.from(c).indexOf(u),C=o.querySelectorAll(".chart-action-btn");C[h]&&C[h].classList.add("active")}}s.classList.add("active");const l=r.getContext("2d"),g={type:n.config.type,data:JSON.parse(JSON.stringify(n.data)),options:JSON.parse(JSON.stringify(n.options))};v=new Chart(l,g),document.body.style.overflow="hidden"}function X(){document.getElementById("chartModal").classList.remove("active"),v&&(v.destroy(),v=null),document.body.style.overflow=""}window.openChartModal=xt;window.closeChartModal=X;document.addEventListener("keydown",t=>{t.key==="Escape"&&document.getElementById("chartModal").classList.contains("active")&&X()});document.getElementById("chartModal")?.addEventListener("click",t=>{t.target.classList.contains("chart-modal")&&X()});async function Pt(t,e){if(t.includes("weekly"))try{const n=window.currentNetworkInfo||await j();window.currentNetworkInfo=n;const s=window.currentBlockData||await G();window.currentBlockData=s;const a=n.height;if(e==="1M"&&f[t]?.length>0&&f[t].some(g=>new Date-new Date(g.timestamp)>=216e7))return D(t,e),!0;let r;if(e==="1M")r=O(a,s,4);else if(e==="3M")r=O(a,s,12);else if(e==="6M")r=O(a,s,26);else if(e==="9M")r=O(a,s,39);else return;const o=f[t]||[],i=r.filter(l=>!o.some(g=>et(g.timestamp,l.endTime)));if(i.length===0)return;const d=await V(t,i,a);if(d.length>0){const l=[...o];d.forEach(c=>{const u=l.findIndex(h=>et(h.timestamp,c.timestamp));if(u>=0){const h=new Date(l[u].timestamp).getTime();(new Date(c.timestamp).getTime()>=h||l[u].count!==c.count)&&(l[u]=c)}else l.push(c)});const g=l.sort((c,u)=>new Date(c.timestamp)-new Date(u.timestamp));return f[t]=g,D(t,e),!0}else console.log(`No new data points found for ${t}`)}catch(n){console.error(`Error fetching additional weekly data for ${t}:`,n)}}function O(t,e,n=12){const s=mt(new Date),a=E(e,s),r=[{endTime:new Date,startTime:s,endHeight:t,startHeight:a?a.blockHeight:e[0].blockHeight}];for(let o=1;o<n;o++){const i=new Date(s);i.setDate(i.getDate()-(o-1)*7);const d=new Date(i);d.setDate(d.getDate()-7);const l=E(e,i),g=E(e,d);l&&g&&r.push({endTime:i,startTime:d,endHeight:l.blockHeight,startHeight:g.blockHeight})}return r.sort((o,i)=>o.startTime-i.startTime)}async function Bt(t,e){try{const n=window.currentNetworkInfo||await j();window.currentNetworkInfo=n;const s=window.currentBlockData||await G();window.currentBlockData=s;const a=n.height;let r;if(e==="1M")r=W(a,s,30);else if(e==="3M")r=W(a,s,90);else return;if(t==="wUSDCTransfer"){await J("wUSDCTransfer",r,a),await J("USDATransfer",r,a),D("wUSDCTransfer",e);return}await J(t,r,a),D(t,e)}catch(n){console.error(`Error fetching additional data for ${t}:`,n)}}async function J(t,e,n){const s=d=>{const l=new Date(d);return`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`},a=f[t]||[],r=new Map;a.forEach(d=>{const l=s(d.timestamp);r.set(l,d)});const o=e.filter(d=>{const l=s(d.endTime);return!r.has(l)});if(o.length===0)return;const i=await V(t,o,n);if(i.length>0){const d=[...a];i.forEach(g=>{const c=s(g.timestamp),u=d.findIndex(h=>s(h.timestamp)===c);u>=0?d[u]=g:d.push(g)});const l=d.sort((g,c)=>new Date(g.timestamp)-new Date(c.timestamp));f[t]=l}else console.log(`No new data points found for ${t}`)}function W(t,e,n){const s=nt(new Date),a=[];a.push({endTime:new Date,startTime:s,endHeight:t,startHeight:e[0].blockHeight});for(let r=1;r<n;r++){const o=new Date(s);o.setUTCDate(o.getUTCDate()-(r-1));const i=new Date(o);i.setUTCDate(i.getUTCDate()-1);const d=E(e,o),l=E(e,i);d&&l&&a.push({endTime:o,startTime:i,endHeight:d.blockHeight,startHeight:l.blockHeight})}return a}function Ht(t,e){console.log(`Updating supply chart with time range: ${e}`);const n=S.wARTotalSupply;if(!n){console.error("No supply chart found");return}if(!t||t.length===0){console.warn("No supply data available");return}const a=[...U(t,e)].sort((i,d)=>new Date(i.timestamp)-new Date(d.timestamp)),r=a.map(i=>y(new Date(i.timestamp))),o=a.map(i=>i.wARSupply);n.data.labels=r,n.data.datasets[0].data=o,n.data.datasets[0].label="wAR Total Supply",n.update("none")}async function qt(t){try{const e=await at(),n=t.replace("Volume","");if(!e[n])throw new Error(`No data found for ${n}`);console.log(`Full ${n} dataset:`,e[n].length,"entries");const s=e[n].map(a=>({timestamp:new Date(a.timestamp).toISOString(),value:a.value}));return f[t]=s,e}catch(e){throw console.error(`Error updating ${t} chart:`,e),e}}function et(t,e){const n=r=>{const o=new Date(r),i=o.getDay();return o.setDate(o.getDate()-i),o.setHours(0,0,0,0),o},s=n(t),a=n(e);return s.getTime()===a.getTime()}async function Jt(){try{Ct(),Rt(),ot(Q,Pt),console.log("Fetching network info and block history...");const t=j().catch(l=>(console.error("Error fetching network info:",l),{height:0})),e=G().catch(l=>(console.error("Error fetching block history:",l),[])),[n,s]=await Promise.all([t,e]);window.currentNetworkInfo=n,window.currentBlockData=s;const a=n.height;console.log(`Current network height: ${a}`);const r=wt(a,s),o=W(a,s,7),i=O(a,s,12),d=r[r.length-1];yt(a,d);try{await F("wARTransfer",r,a)}catch(l){console.error("Error loading primary chart:",l)}K(!1),Kt().catch(l=>{console.error("Error loading supply chart:",l),m("wARTotalSupply",!1)}),Object.keys(B).forEach(l=>{if(!l.includes("weekly")&&l!=="wARTotalSupply"&&l!=="wARTransfer"){const g=["AOTransfer","permaswap","botega","llamaLand","bazarAADaily"].includes(l)?o:r;F(l,g,a).catch(c=>{console.error(`Error loading ${l} chart:`,c),m(l,!1)})}}),Object.keys(B).forEach(l=>{l.includes("weekly")&&F(l,i,a).catch(g=>{console.error(`Error loading ${l} chart:`,g),m(l,!1)})}),document.getElementById("nodeCount").textContent=lt.length,_t(),Ft().catch(l=>{console.error("Error loading Stargrid chart:",l),m("stargrid",!1)}),zt().catch(l=>{console.error("Error loading Stargrid matches chart:",l),m("stargridMatches",!1)}),_("AOVolume").catch(l=>{console.error("Error loading AO Volume chart:",l),m("AOVolume",!1)}),_("wARVolume").catch(l=>{console.error("Error loading wAR Volume chart:",l),m("wARVolume",!1)}),_("wUSDCVolume").catch(l=>{console.error("Error loading wUSDC Volume chart:",l),m("wUSDCVolume",!1)})}catch(t){console.error("Error initializing dashboard:",t),K(!1)}}async function _t(){const t="https://raw.githubusercontent.com/Jonny-Ringo/the_eye_of_AO/main/data/dev-addresses.csv";try{const a=(await(await fetch(t)).text()).trim().split(/\r?\n/).filter(r=>r.length>0).length;document.getElementById("activeDevCount").textContent=a.toLocaleString()}catch(e){console.error("Failed to load dev address count:",e),document.getElementById("activeDevCount").textContent="N/A"}}async function Ft(){try{console.log("Loading Stargrid chart..."),m("stargrid",!0);const t=await H();if(console.log(`Loaded Stargrid data: ${t.length} points`),t.length>0){f.stargrid=t;const e=k("stargrid");D("stargrid",e)}}catch(t){console.error("Error loading Stargrid chart:",t)}finally{m("stargrid",!1)}}async function zt(){try{console.log("Loading Stargrid matches chart..."),m("stargridMatches",!0);const t=await H();if(console.log(`Loaded Stargrid matches data: ${t.length} points`),t.length>0){f.stargridMatches=t;const e=k("stargridMatches");D("stargridMatches",e)}}catch(t){console.error("Error loading Stargrid matches chart:",t)}finally{m("stargridMatches",!1)}}async function _(t){try{console.log(`Loading ${t} chart...`),m(t,!0);const e=await at(),s={AOVolume:"AO",wARVolume:"wAR",wUSDCVolume:"wUSDC"}[t];if(!s||!e[s])throw new Error(`No data found for ${t}`);const a=e[s];if(a.length>0){f[t]=a;const r=k(t);console.log(`Time range for ${t}:`,r),D(t,r)}}catch(e){console.error(`Error loading ${t} chart:`,e)}finally{m(t,!1)}}async function F(t,e,n){try{if(t==="USDATransfer")return;if(m(t,!0),t==="wUSDCTransfer"){const s=V("wUSDCTransfer",e,n).catch(d=>(console.error("Error fetching wUSDCTransfer data:",d),[])),a=V("USDATransfer",e,n).catch(d=>(console.error("Error fetching USDATransfer data:",d),[])),[r,o]=await Promise.all([s,a]);r.length>0&&(f.wUSDCTransfer=r),o.length>0&&(f.USDATransfer=o);const i=k("wUSDCTransfer");st("wUSDCTransfer","USDATransfer",i),m(t,!1)}else{const s=await V(t,e,n);if(s.length>0){f[t]=s;const a=k(t);D(t,a),m(t,!1)}}}catch(s){throw console.error(`Error loading ${t} chart:`,s),s}}async function Kt(){try{m("wARTotalSupply",!0);const t=await ht();if(!t)throw new Error("Failed to fetch supply data");const n=t.wAR.map(a=>({timestamp:a.date,wARSupply:Number(a.totalSupply)/1e12})).map(a=>({...a,timestamp:new Date(a.timestamp).toISOString()}));f.wARTotalSupply=n;const s=k("wARTotalSupply");D("wARTotalSupply",s)}catch(t){throw console.error("Error updating supply chart:",t),t}finally{m("wARTotalSupply",!1)}}document.addEventListener("DOMContentLoaded",Jt);
